FROM apache/airflow:3.0.6-python3.9


ENV AIRFLOW__CORE__EXECUTOR=${AIRFLOW__CORE__EXECUTOR:-"CeleryExecutor"}
ENV AIRFLOW__CORE__LOAD_EXAMPLES=${AIRFLOW__CORE__LOAD_EXAMPLES:-"false"}
ENV AIRFLOW__CORE__AUTH_MANAGER=${AIRFLOW__CORE__AUTH_MANAGER:-"airflow.providers.fab.auth_manager.fab_auth_manager.FabAuthManager"}
ENV AIRFLOW__API__EXPOSE_CONFIG=${AIRFLOW__API__EXPOSE_CONFIG:-"false"}
ENV AIRFLOW__API__EXPOSE_STACKTRACE=${AIRFLOW__API__EXPOSE_STACKTRACE:-"false"}
ENV AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION=${AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION:-"false"}
ENV AIRFLOW__SCHEDULER__ENABLE_HEALTH_CHECK=${AIRFLOW__SCHEDULER__ENABLE_HEALTH_CHECK:-"true"}
ENV AIRFLOW__CORE__FERNET_KEY=${AIRFLOW__CORE__FERNET_KEY:-"vYgDn-AesJP0QqFphmuOyuX4Qmw0CYeyWjULGiROzmE="}
ENV AIRFLOW__CORE__HOSTNAME_CALLABLE="airflow.utils.net.get_host_ip_address"

ENV AIRFLOW__METRICS__STATSD_ON=${AIRFLOW__METRICS__STATSD_ON:-"true"}
ENV AIRFLOW__METRICS__STATSD_HOST=${AIRFLOW__METRICS__STATSD_HOST:-"statsd-exporter"}
ENV AIRFLOW__METRICS__STATSD_PORT=${AIRFLOW__METRICS__STATSD_PORT:-"9125"}
ENV AIRFLOW__METRICS__STATSD_PREFIX=${AIRFLOW__METRICS__STATSD_PREFIX:-"airflow"}

ENV AIRFLOW_VAR_RAY_ADDRESS=${AIRFLOW_VAR_RAY_ADDRESS:-"ray://ray:10001"}

ENV AIRFLOW__API__SECRET_KEY=${AIRFLOW__API__SECRET_KEY:-"f5612881f0babd596abee4264b41aba00277e64ee2e87473a824bae7d9e95203ed62e14cae29a7549c01da9c06144cd94d0af70da672c53e10d76a7fd385b586"}


USER root
WORKDIR /app


COPY entrypoint.sh .
RUN chmod +x entrypoint.sh
ENTRYPOINT ["./entrypoint.sh"]
